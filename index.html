<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            background: radial-gradient(circle, #1e293b 0%, #0f172a 100%); 
            text-align: center; color: white; font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 100vh; margin: 0; overflow: hidden; touch-action: manipulation;
        }
        #skin { 
            font-size: 160px; cursor: pointer; transition: transform 0.05s; 
            user-select: none; -webkit-user-select: none; filter: drop-shadow(0 0 20px rgba(0,255,255,0.3));
        }
        #skin:active { transform: scale(0.92); }
        #score-container { margin-top: 20px; }
        #total-score { font-size: 48px; font-weight: bold; color: #fbbf24; }
        .label { font-size: 14px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        .plus-one { 
            position: absolute; color: #fbbf24; font-size: 28px; font-weight: bold; 
            pointer-events: none; animation: moveUp 0.8s ease-out forwards; 
        }
        @keyframes moveUp { 
            0% { transform: translateY(0); opacity: 1; } 
            100% { transform: translateY(-120px); opacity: 0; } 
        }
    </style>
</head>
<body>

    <div class="label">–¢–≤–æ–π –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
    <div id="score-container">
        <span id="total-score">0</span> üí∞
    </div>
    
    <div id="skin">üé±</div>
    <div id="session-info" style="margin-top: 10px; font-size: 12px; color: #64748b;">
        –ù–∞–∂–∞—Ç–æ –∑–∞ —Å–µ–π—á–∞—Å: +<span id="session-points">0</span>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // 1. –ü–û–õ–£–ß–ê–ï–ú –î–ê–ù–ù–´–ï
        // –ë–∞–ª–∞–Ω—Å –∏–∑ –±–∞–∑—ã –±–æ—Ç–∞ (—á–µ—Ä–µ–∑ URL)
        const urlParams = new URLSearchParams(window.location.search);
        const baseBalance = parseInt(urlParams.get('bal')) || 0;

        // "–ù–∞—Ç–æ–ø–∞–Ω–Ω–æ–µ", –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ (–∏–∑ –ø–∞–º—è—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
        let sessionTaps = parseInt(localStorage.getItem('tap8_session')) || 0;

        // –°–∫–∏–Ω—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –û–ë–©–ï–ì–û —Å—á–µ—Ç–∞
        const skins = [
            { limit: 0, icon: "üé±" },
            { limit: 1000, icon: "ü•â" },
            { limit: 5000, icon: "ü•à" },
            { limit: 10000, icon: "ü•á" },
            { limit: 50000, icon: "üíé" }
        ];

        const scoreEl = document.getElementById("total-score");
        const sessionEl = document.getElementById("session-points");
        const skinEl = document.getElementById("skin");

        function updateUI() {
            let total = baseBalance + sessionTaps;
            scoreEl.innerText = total.toLocaleString();
            sessionEl.innerText = sessionTaps;

            // –ú–µ–Ω—è–µ–º —Å–∫–∏–Ω
            let currentIcon = skins[0].icon;
            for (let s of skins) {
                if (total >= s.limit) currentIcon = s.icon;
            }
            skinEl.innerText = currentIcon;
        }

        // –ö–õ–ò–ö
        skinEl.onclick = function(event) {
            sessionTaps++;
            localStorage.setItem('tap8_session', sessionTaps); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–∞–º—è—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            updateUI();

            // –ê–Ω–∏–º–∞—Ü–∏—è +1
            let p = document.createElement("div");
            p.innerText = "+1";
            p.className = "plus-one";
            p.style.left = event.clientX + "px";
            p.style.top = event.clientY + "px";
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);

            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        };

        // –°–û–•–†–ê–ù–ï–ù–ò–ï
        tg.MainButton.setText("–°–û–•–†–ê–ù–ò–¢–¨ –í –ë–û–¢–ï");
        tg.MainButton.show();
        tg.onEvent("mainButtonClicked", function() {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–æ—Ç—É –¢–û–õ–¨–ö–û —Ç–æ, —á—Ç–æ –Ω–∞—Ç–∞–ø–∞–ª–∏ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
            tg.sendData(sessionTaps.toString());
            localStorage.removeItem('tap8_session'); // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
        });

        updateUI(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    </script>
</body>
</html>
